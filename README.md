# Certificate Authority Management Scripts
Набор скриптов для создания собственного Центра Сертификации (CA) и генерации SSL/TLS сертификатов.

Файлы
create_CA.sh - Создание корневого Центра Сертификации

create_cert.sh - Генерация сертификатов, подписанных CA

config_crt.cfg - Конфигурационный файл для настройки параметров

Предварительные требования
Ubuntu/Debian или другая Linux-система

OpenSSL установлен в системе

Права sudo для установки корневого сертификата

# Быстрый старт

Настройте конфигурацию (отредактируйте config_crt.cfg):

```bash
nano config_crt.cfg
```

# Создайте Центр Сертификации:

```bash
./create_CA.sh
```

# Сгенерируйте сертификат:

```bash
./create_cert.sh
```

# Подробное описание

1. Конфигурационный файл config_crt.cfg

Файл содержит настройки для генерации сертификатов:
```text
ini
[CA]
ORG="<org>"                    # Название организации
CANAME="CA_${ORG}"            # Имя CA (генерируется автоматически)
CITY="<bar>"                    # Город
LOCATION="<foo>"                # Локация/отдел
RETENTION_CA=3650             # Срок жизни CA сертификата (дней)
RETENTION=3650                # Срок жизни клиентских сертификатов
CA_DIR="${CANAME}"            # Директория CA

[crt]
MYCERT="<examle>"               # Имя сертификата
FQDN="${MYCERT}.${LOCATION}.${ORG}"  # Полное доменное имя

[alt_name]
DNS1="${FQDN}"                # DNS запись 1
DNS2="${MYCERT}"              # DNS запись 2  
DNS3="${MYCERT}.${LOCATION}"  # DNS запись 3
IP1="<ip>"             # IP адрес
```

# 2. Скрипт создания CA create_CA.sh

Назначение: Создает корневой Центр Сертификации.

# Функциональность:

Создает защищенный приватный ключ CA (RSA 4096 бит, AES256)

Генерирует самоподписанный корневой сертификат

Автоматически генерирует сложный пароль для ключа

Устанавливает CA сертификат в систему как доверенный

# Использование:
```bash
chmod +x create_CA.sh
./create_CA.sh
```

# Результат:

Директория CA_<org>/ с файлами:

.pass - пароль от приватного ключа

CA_<org>.key - приватный ключ CA (зашифрованный)

CA_<org>.crt - корневой сертификат

# 3. Скрипт создания сертификата create_cert.sh

Назначение: Генерирует клиентские SSL/TLS сертификаты, подписанные CA.

# Функциональность:

Создает приватный ключ и Certificate Signing Request (CSR)

Автоматически генерирует конфигурацию Subject Alternative Names (SAN)

Подписывает CSR с помощью CA

Удаляет пароль из приватного ключа для удобства использования

Создает цепочку сертификатов

# Использование:
```bash
chmod +x create_cert.sh
./create_cert.sh
```

# Результат:

Директория <certificate_name>/ с файлами:

.pass - пароль от приватного ключа (временный)

<certificate_name>.key - приватный ключ (без пароля)

<certificate_name>.csr - запрос на подпись

<certificate_name>.crt - подписанный сертификат

<certificate_name>.v3.ext - конфигурация расширений

# Структура файлов после выполнения
```text
./
├── config_crt.cfg
├── create_CA.sh
├── create_cert.sh
├── CA_<org>/
│   ├── .pass
│   ├── CA_<org>.key
│   ├── CA_<org>.crt
│   └── CA_<org>.srl
└── netbox/
    ├── .pass
    ├── <certificate_name>.key
    ├── <certificate_name>.csr
    ├── <certificate_name>.crt
    └── <certificate_name>.v3.ext
```

# Особенности
# Безопасность
Автоматическая генерация сложных паролей (25 символов)

Приватные ключи шифруются с использованием AES256

Пароли хранятся отдельно в защищенных файлах

После генерации пароль удаляется из клиентских ключей

# Гибкость
Поддержка множественных DNS имен и IP адресов через SAN

Настраиваемые сроки действия сертификатов

Легко настраиваемые параметры через конфигурационный файл

Автоматизация
Скрипты проверяют существование файлов для избежания перезаписи

Автоматическая установка CA сертификата в систему

Проверка корректности созданных сертификатов

# Использование сертификатов

Для веб-сервера (Nginx/Apache):

nginx
```text
ssl_certificate /path/to/<certificate_name>.crt;
ssl_certificate_key /path/to/<certificate_name>.key;
```

# Для проверки сертификата:
```bash
openssl x509 -in netbox.crt -text -noout
```

# Для проверки цепочки:
```bash
openssl verify -CAfile CA_<org>.crt <certificate_name>.crt
```

# Важные замечания

Безопасность файлов паролей: Файлы .pass содержат критически важную информацию. Обеспечьте их надлежащую защиту.

Резервное копирование: Регулярно создавайте резервные копии директории CA.

Сроки действия: По умолчанию сертификаты действительны 10 лет. Настройте под свои потребности.

Доверие CA: Корневой сертификат автоматически устанавливается в систему через update-ca-certificates.

# Решение проблем
Ошибка "Configuration file not found"
Убедитесь, что config_crt.cfg находится в той же директории, что и скрипты.

Ошибка прав доступа
Дайте права на выполнение скриптам:

```bash
chmod +x *.sh
```

Ошибка подписи сертификата
Проверьте, что файл пароля CA существует и доступен для чтения.
