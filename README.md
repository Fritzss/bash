# Certificate Generation Script

Этот скрипт автоматизирует процесс создания корневого сертификата Центра Сертификации (CA) и подписанных им сертификатов с поддержкой SAN (Subject Alternative Name).

### Особенности

Создание корневого сертификата Центра Сертификации

Генерация сертификатов с поддержкой SAN (DNS и IP-адреса)

Автоматическая настройка системного хранилища доверенных сертификатов

Срок действия сертификатов до 10 лет

Гибкая конфигурация через переменные

Удаление пароля с серверного ключа сертификата 

## Предварительные требования

OpenSSL (установите через пакетный менеджер вашей ОС)

Права sudo для установки корневого сертификата

### Конфигурация

Перед запуском отредактируйте переменные в начале скрипта:
```
ORG="org"                      # Название организации
CANAME="CA_${ORG}"             # Имя Центра Сертификации
CITY="town"                    # Город
LOCATION="local"               # Локация/отдел
MYCERT="<asd>.${LOCATION}.${ORG}" # Доменное имя сертификата
RETENTION_CA=3650              # Срок действия CA (дней)
RETENTION=3650                 # Срок действия сертификата (дней)
```

#### ВАЖНО: Замените плейсхолдеры в SAN-конфигурации:
```
DNS.1=${MYCERT}
DNS.2=<qwe>.${LOCATION}.${ORG}  # Замените <qwe>
DNS.3=<zxc>.${LOCATION}.${ORG}  # Замените <zxc>
IP.1=<ipaddr>                   # Замените <ipaddr> на реальный IP
```

#### Использование
Сделайте скрипт исполняемым:
```
bash
chmod +x create_certs.sh
```

Запустите скрипт:
bash
```
./create_certs.sh
```

Во время генерации CA-ключа введите надежный пароль

Структура генерируемых файлов

В директории CA_org/ будут созданы:

text
```
CA_org/

├── CA_org.crt        # Сертификат Центра Сертификации
├── CA_org.key        # Приватный ключ CA (зашифрованный)
├── <asd>.local.org.crt  # Сертификат сервера
├── <asd>.local.org.csr  # Запрос на подпись сертификата
├── <asd>.local.org.key  # Приватный ключ сервера
└── <asd>.local.org.v3.ext # Конфигурация SAN
```

### Важные примечания

Безопасность приватных ключей:

CA-ключ (CA_org.key) защищен паролем

Ключи серверов хранятся без пароля

Храните CA-ключ в безопасном месте

## SAN-конфигурация:

По умолчанию скрипт генерирует сертификат с поддержкой 3 DNS-имен и 1 IP-адреса

Для добавления дополнительных записей отредактируйте блок [alt_names] в скрипте

## Срок действия:

Корневой сертификат: 10 лет (3650 дней)

Серверный сертификат: 10 лет (3650 дней)

При необходимости измените переменные RETENTION_CA и RETENTION

Системное хранилище:

Скрипт автоматически добавляет CA-сертификат в системное хранилище

Для отмены закомментируйте блок:

bash
```
sudo cp "${CANAME}.crt" /usr/local/share/ca-certificates/
sudo update-ca-certificates
```
Проверка сертификата
После выполнения скрипт автоматически проверит DNS-записи в сертификате:

text
Проверка DNS-записей:
    DNS:<asd>.local.org, DNS:<qwe>.local.org, DNS:<zxc>.local.org
Для ручной проверки:

bash
```
openssl x509 -in CA_org/<asd>.local.org.crt -text -noout
```
Лицензия
Этот скрипт распространяется по лицензии MIT. Используйте на свой страх и риск.
